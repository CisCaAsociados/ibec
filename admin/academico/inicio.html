<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Administración Académica - IBEC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .sidebar { min-height: 100vh; background-color: #2c3e50; color: white; }
        .sidebar .nav-link { color: #bdc3c7; }
        .sidebar .nav-link:hover { background-color: #34495e; }
        .sidebar .nav-link.active { background-color: #3498db; color: white; border-radius: 8px; margin: 0 10px; }
        .main-content { padding: 20px; }
        .footer { margin-top: 50px; color: #95a5a6; font-size: 0.9em; }
        .card-quick { 
            transition: transform 0.2s, box-shadow 0.2s; 
            cursor: pointer; 
            height: 100%; 
            border: none; 
            border-radius: 12px;
        }
        .card-quick:hover { 
            transform: translateY(-5px); 
            box-shadow: 0 10px 20px rgba(0,0,0,0.15); 
        }
        .card-quick .card-body { 
            text-align: center; 
            padding: 25px 15px; 
        }
        .card-quick i { 
            font-size: 2.5rem; 
            margin-bottom: 15px; 
        }
        .bg-asistencia { background: linear-gradient(135deg, #26a69a, #00695c); color: white; }
        .bg-notas { background: linear-gradient(135deg, #7e57c2, #512da8); color: white; }
        .bg-pagos { background: linear-gradient(135deg, #ffa726, #f57c00); color: white; }
        .bg-estudiantes { background: linear-gradient(135deg, #42a5f5, #1565c0); color: white; }
        #mensaje-verificacion { margin-bottom: 20px; }
    </style>
</head>
<body>

    <!-- Contenedor principal -->
    <div class="container-fluid">
        <div class="row">
            <!-- Menú Lateral (se generará dinámicamente) -->
            <nav id="sidebar" class="col-md-3 col-lg-2 sidebar">
                <div class="position-sticky pt-3">
                    <h5 class="text-white text-center py-3 border-bottom">Académico</h5>
                    <ul id="menu-dinamico" class="nav flex-column">
                        <!-- Se llenará con JavaScript -->
                    </ul>
                </div>
            </nav>

            <!-- Contenido Principal -->
            <main id="main-content" class="col-md-9 ms-sm-auto col-lg-10 main-content">
                <!-- Mensaje de verificación o error -->
                <div id="mensaje-verificacion"></div>

                <!-- Aquí se cargará el contenido dinámico -->
                <div id="contenido-dinamico">
                    <p class="text-muted">Verificando permisos...</p>
                </div>

                <!-- Pie de página -->
                <div class="footer text-center mt-5">
                    <p>© 2025 Instituto Bíblico El Camino (IBEC) — Administración Académica</p>
                </div>
            </main>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

    <!-- Configuración de Firebase -->
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCV_UwzE7uPv67-3iR2Arv71fOL6fd1wdw",
            authDomain: "ibec-login.firebaseapp.com",
            projectId: "ibec-login",
            storageBucket: "ibec-login.firebasestorage.app",
            messagingSenderId: "616348709046",
            appId: "1:616348709046:web:07e77e7e2fba90a0b57617",
            measurementId: "G-0R13GPY97Z"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    </script>

    <!-- Script principal -->
    <script>
        // Verificar autenticación y rol al cargar
        auth.onAuthStateChanged(async function(user) {
            if (!user) {
                // No hay usuario logueado
                window.location.href = "../../login.html";
                return;
            }

            try {
                // Obtener datos del usuario
                const userDoc = await db.collection("usuarios").doc(user.uid).get();
                if (!userDoc.exists) {
                    document.getElementById('mensaje-verificacion').innerHTML = 
                        '<div class="alert alert-danger">Usuario no encontrado en la base de datos.</div>';
                    return;
                }

                const userData = userDoc.data();
                const rol = userData.rol || 'invitado';
                const nombres = userData.nombres || 'Usuario';
                const apellidos = userData.apellidos || '';

                // Verificar permisos
                if (rol !== 'admin' && rol !== 'admin_academico') {
                    document.getElementById('mensaje-verificacion').innerHTML = 
                        '<div class="alert alert-warning">No tienes permiso para acceder a esta sección.</div>';
                    setTimeout(() => {
                        window.location.href = "../../dashboard.html";
                    }, 3000);
                    return;
                }

                // Mostrar mensaje de bienvenida
                document.getElementById('mensaje-verificacion').innerHTML = 
                    `<div class="alert alert-success">✅ Sesión iniciada como: <strong>${nombres} ${apellidos}</strong> (${rol === 'admin' ? 'Administrador' : 'Administración Académica'})</div>`;

                // Generar menú
                generarMenu(rol);

                // Generar contenido
                generarContenido(nombres, apellidos, rol);

            } catch (error) {
                console.error("Error:", error);
                document.getElementById('mensaje-verificacion').innerHTML = 
                    '<div class="alert alert-danger">Error al cargar la página. Intenta nuevamente.</div>';
            }
        });

        function generarMenu(rol) {
            const menu = document.getElementById('menu-dinamico');
            let html = `
                <li class="nav-item">
                    <a class="nav-link active" href="inicio.html">
                        <i class="bi bi-journal-text"></i> Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="asignaturas/gestionar.html">
                        <i class="bi bi-book"></i> Gestionar Asignaturas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="grupos/crear.html">
                        <i class="bi bi-people-fill"></i> Gestionar Grupos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="matriculas/gestionar.html">
                        <i class="bi bi-pencil-square"></i> Gestionar Matrículas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../estudiantes/inicio.html">
                        <i class="bi bi-mortarboard"></i> Gestionar Estudiantes
                    </a>
                </li>
                <li class="nav-item mt-4">
                    <a class="nav-link text-warning" href="../../dashboard.html">
                        <i class="bi bi-arrow-left"></i> Volver al Panel
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-danger" href="../../logout.html">
                        <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
                    </a>
                </li>
            `;
            menu.innerHTML = html;
        }

        function generarContenido(nombres, apellidos, rol) {
            let contenido = `
                <!-- Título principal -->
                <div class="text-center my-5">
                    <h1 class="text-primary">Administración Académica</h1>
                    <p class="text-muted">Sistema de Gestión Académica del Instituto Bíblico El Camino</p>
                </div>

                <!-- Información del usuario -->
                <div class="row justify-content-center mb-5">
                    <div class="col-md-8">
                        <div class="card bg-light shadow-sm">
                            <div class="card-body text-center">
                                <h5><i class="bi bi-person-badge"></i> Sesión Iniciada</h5>
                                <p class="mb-1"><strong>Usuario:</strong> ${nombres} ${apellidos}</p>
                                <p class="mb-0"><strong>Rol:</strong> ${rol === 'admin' ? 'Administrador' : 'Administración Académica'}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cuadritos de acceso rápido -->
                <div class="row g-4 justify-content-center">
                    <!-- Tomar Asistencia -->
                    <div class="col-md-6 col-lg-4">
                        <a href="asistencias/tomar.html" class="text-decoration-none">
                            <div class="card card-quick bg-asistencia">
                                <div class="card-body">
                                    <i class="bi bi-check-circle"></i>
                                    <h5>Tomar Asistencia</h5>
                                    <p>Registra la asistencia de estudiantes por grupo y clase</p>
                                </div>
                            </div>
                        </a>
                    </div>

                    <!-- Reportes de Asistencia -->
                    <div class="col-md-6 col-lg-4">
                        <a href="javascript:void(0)" onclick="alert('En desarrollo. Pronto disponible.')" class="text-decoration-none">
                            <div class="card card-quick bg-info text-white">
                                <div class="card-body">
                                    <i class="bi bi-file-earmark-bar-graph"></i>
                                    <h5>Reportes de Asistencia</h5>
                                    <p>(Temporalmente desactivado)</p>
                                </div>
                            </div>
                        </a>
                    </div>

                    <!-- Ingreso de Notas -->
                    <div class="col-md-6 col-lg-4">
                        <a href="notas/ingresar.html" class="text-decoration-none">
                            <div class="card card-quick bg-notas">
                                <div class="card-body">
                                    <i class="bi bi-clipboard2-check"></i>
                                    <h5>Ingreso de Notas</h5>
                                    <p>Ingresa calificaciones de tareas, exámenes y asistencia</p>
                                </div>
                            </div>
                        </a>
                    </div>

                    <!-- Reportes de Notas -->
                    <div class="col-md-6 col-lg-4">
                        <a href="javascript:void(0)" onclick="alert('En desarrollo. Pronto disponible.')" class="text-decoration-none">
                            <div class="card card-quick bg-success text-white">
                                <div class="card-body">
                                    <i class="bi bi-graph-up"></i>
                                    <h5>Reportes de Notas</h5>
                                    <p>(Temporalmente desactivado)</p>
                                </div>
                            </div>
                        </a>
                    </div>

                    <!-- Gestión de Pagos -->
                    <div class="col-md-6 col-lg-4">
                        <a href="pagos/gestionar.html" class="text-decoration-none">
                            <div class="card card-quick bg-pagos">
                                <div class="card-body">
                                    <i class="bi bi-credit-card"></i>
                                    <h5>Gestión de Pagos</h5>
                                    <p>Registra pagos de matrícula, mensualidades y emite recibos</p>
                                </div>
                            </div>
                        </a>
                    </div>

                    <!-- Gestionar Estudiantes -->
                    <div class="col-md-6 col-lg-4">
                        <a href="../../estudiantes/inicio.html" class="text-decoration-none">
                            <div class="card card-quick bg-estudiantes">
                                <div class="card-body">
                                    <i class="bi bi-mortarboard"></i>
                                    <h5>Gestionar Estudiantes</h5>
                                    <p>Administra la matrícula, datos y historial de estudiantes</p>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            `;
            document.getElementById('contenido-dinamico').innerHTML = contenido;
        }
    </script>

</body>
</html>
